function e(e){return u.has(e)||u.set(e,{scene:null,camera:null,renderer:null,model:null,ambientLight:null,directionalLight:null,fillLight:null,customColorMap:null,customNormalMap:null,customEnvMap:null,envMap:null}),u.get(e)}function a(e){const a=new THREE.MeshStandardMaterial;return a.color.copy(e.color),a.map=e.map,a.normalMap=e.normalMap,a.emissiveMap=e.emissiveMap,a.aoMap=e.aoMap,a.emissive.copy(e.emissive||new THREE.Color(0,0,0)),a.opacity=e.opacity??1,a.transparent=e.transparent??!1,a.side=e.side??THREE.FrontSide,e.userData||(e.userData={}),a.userData=e.userData,a.userData.converted=!0,a}function t(e){var a;return(null==(a=e.colorMapUrl)?void 0:a.trim())&&!e.renderNormals}function n(e,a=!1,t=!1){return new Promise(t=>{p.load(e,e=>{a?(e.mapping=THREE.EquirectangularReflectionMapping,e.colorSpace=THREE.SRGBColorSpace,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1):(e.wrapS=e.wrapT=THREE.RepeatWrapping,e.flipY=!0),t(e)})})}function r(e,a){if(!a||!e.renderer)return;const t=e.renderer.capabilities.getMaxAnisotropy();t&&(a.anisotropy=Math.min(8,t)),a.generateMipmaps=!0,a.minFilter=THREE.LinearMipmapLinearFilter,a.magFilter=THREE.LinearFilter,a.needsUpdate=!0}function o(e,a){e.renderer&&(e.renderer.toneMapping=a?THREE.ACESFilmicToneMapping:THREE.NoToneMapping,e.renderer.toneMappingExposure=a?1.5:1,e.renderer.physicallyCorrectLights=a,e.renderer.userData||(e.renderer.userData={}),e.renderer.userData.q=a?"h":"f")}function i(e,a,t){var n;a&&e.model&&(null==(n=e.model.userData.materials)||n.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMap=a,e.envMapIntensity=t,e.needsUpdate=!0)}))}function l(e){var a;e.model&&(null==(a=e.model.userData.materials)||a.forEach(e=>{e.envMap&&(e.envMap=null,e.needsUpdate=!0)}),e.envMap&&e.envMap.dispose(),e.envMap=null)}function s(e,a,t,n,r,o){var s;if(t&&a)if(e.envMap)e.model.userData.lastEnvMapIntensity!==o&&(null==(s=e.model.userData.materials)||s.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMapIntensity=o)}),e.model.userData.lastEnvMapIntensity=o);else{e.envMap=new THREE.Texture,e.envMap.mapping=THREE.EquirectangularReflectionMapping,e.envMap.colorSpace=THREE.SRGBColorSpace,e.envMap.minFilter=THREE.LinearFilter,e.envMap.magFilter=THREE.LinearFilter,e.envMap.generateMipmaps=!1,e.envMap.flipY=!1,e.envMap.image={width:n,height:r};const a=e.renderer.properties.get(e.envMap);a.__webglTexture=t,a.__webglInit=!0;const l=e.renderer.info.memory;l&&l.textures++,i(e,e.envMap,o)}else l(e)}function initialize(a,l){var s,m,p;const c=e(l),u=a.canvas?a.canvas.width:a.drawingBufferWidth,d=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0!==u&&0!==d){if(c.scene=new THREE.Scene,c.camera=new THREE.PerspectiveCamera(35,u/d,.1,100),c.camera.position.set(0,0,5),c.renderer=new THREE.WebGLRenderer({canvas:a.canvas,context:a,alpha:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0,antialias:"high"===l.quality}),c.renderer.setClearColor(0,0),c.renderer.outputColorSpace=THREE.SRGBColorSpace,o(c,"high"===l.quality),c.renderer.setPixelRatio(1),c.renderer.setSize(u,d,!1),c.ambientLight=new THREE.AmbientLight(l.ambientLightColor||"#ffffff",1.5),c.scene.add(c.ambientLight),c.directionalLight=new THREE.DirectionalLight(l.lightColor||"#ffffff",2),c.directionalLight.position.set(5,5,5),c.scene.add(c.directionalLight),c.fillLight=new THREE.DirectionalLight(l.fillLightColor||"#ffffff",1),c.fillLight.position.set(-5,5,-5),c.scene.add(c.fillLight),c.ambientLight&&(c.ambientLight.intensity=2*(l.ambientLightIntensity??.75)),c.directionalLight&&(c.directionalLight.intensity=5*(l.lightIntensity??.2)*2),c.fillLight&&(c.fillLight.intensity=5*(l.fillLightIntensity??.2)*2),l.lightPosition){const e=10*(l.lightPosition.x-.5),a=10*(l.lightPosition.y-.5),t=10*(l.lightPosition.z-.5);c.directionalLight&&c.directionalLight.position.set(e,-a,t),c.fillLight&&c.fillLight.position.set(.8*-e,.8*a,.8*-t)}(null==(s=l.colorMapUrl)?void 0:s.trim())&&t(l)&&n(l.colorMapUrl,!1).then(e=>{var a,t,n,r;const o=Math.max(.001,l.colorMapScale||1);e.repeat.setScalar(o);const i=-(o-1)/2,s=((null==(a=l.colorMapPosition)?void 0:a.x)??.5)-.5,m=((null==(t=l.colorMapPosition)?void 0:t.y)??.5)-.5;e.offset.set(i+s,i+m),c.customColorMap=e,null==(r=null==(n=c.model)?void 0:n.userData.textureMaterials)||r.forEach(a=>{a.map=e,a.needsUpdate=!0})}),(null==(m=l.normalMapUrl)?void 0:m.trim())&&!l.renderNormals&&n(l.normalMapUrl,!1,!0).then(e=>{var a,t,n,o;r(c,e);const i=Math.max(.001,l.normalMapScale||1);e.repeat.setScalar(i);const s=-(i-1)/2,m=((null==(a=l.normalMapPosition)?void 0:a.x)??.5)-.5,p=((null==(t=l.normalMapPosition)?void 0:t.y)??.5)-.5;e.offset.set(s+m,s+p),c.customNormalMap=e;const u=l.normalMapIntensity??1;null==(o=null==(n=c.model)?void 0:n.userData.textureMaterials)||o.forEach(a=>{void 0!==a.normalMap&&(a.normalMap=e,a.normalScale&&a.normalScale.set(u,-u),a.needsUpdate=!0)})}),(null==(p=l.environmentMapUrl)?void 0:p.trim())&&l.environmentMapIntensity>0&&n(l.environmentMapUrl,!0).then(e=>{c.customEnvMap=e,l.local.modelLoaded&&i(c,c.customEnvMap,l.environmentMapIntensity)})}}function loadModel(n){const o=e(n);m.load(n.modelUrl,e=>{var l;o.model=e.scene;const s=(new THREE.Box3).setFromObject(o.model),m=s.getCenter(new THREE.Vector3);o.model.position.copy(m).multiplyScalar(-1);const p=s.getSize(new THREE.Vector3),u=Math.max(p.x,p.y,p.z),d=u>0?1/u:1,M=new THREE.Group;if(M.add(o.model),o.model=M,o.model.userData.baseScale=d,o.model.userData.materials=[],o.model.userData.textureMaterials=[],o.model.userData.meshes=[],o.model.traverse(e=>{e.isMesh&&(o.model.userData.meshes.push(e),(Array.isArray(e.material)?e.material:[e.material]).forEach((t,n)=>{if(t.userData||(t.userData={}),void 0===t.userData.originalMap&&(t.userData.originalMap=t.map||null),void 0===t.userData.originalNormalMap&&(t.userData.originalNormalMap=t.normalMap||null),(t.isMeshPhongMaterial||t.isMeshLambertMaterial)&&!t.userData.converted){const r=a(t);Array.isArray(e.material)?e.material[n]=r:e.material=r,t=r}["map","normalMap","roughnessMap","metalnessMap","emissiveMap","aoMap"].forEach(e=>{t[e]&&r(o,t[e])}),o.model.userData.materials.push(t),(t.isMeshStandardMaterial||t.isMeshPhongMaterial||t.isMeshLambertMaterial)&&o.model.userData.textureMaterials.push(t)}))}),o.model.userData.materials&&o.model.userData.materials.forEach(e=>{void 0!==e.metalness&&(e.metalnessMap&&(e.metalnessMap=null,e.needsUpdate=!0),e.metalness=n.materialMetalness??e.metalness),void 0!==e.roughness&&(e.roughnessMap&&(e.roughnessMap=null,e.needsUpdate=!0),e.roughness=n.materialRoughness??e.roughness),(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMapIntensity=e.envMapIntensity??1)}),n.renderNormals&&o.model.userData.meshes&&o.model.userData.meshes.forEach(e=>{e.userData.originalMaterial||(e.userData.originalMaterial=e.material,e.material=c)}),(null==(l=n.colorMapUrl)?void 0:l.trim())&&t(n)&&o.model.userData.textureMaterials&&o.model.userData.textureMaterials.forEach(e=>{e.map=null,e.needsUpdate=!0}),o.customNormalMap&&!n.renderNormals&&o.model.userData.textureMaterials){const e=n.normalMapIntensity??1;o.model.userData.textureMaterials.forEach(a=>{void 0!==a.normalMap&&(a.normalMap=o.customNormalMap,a.normalScale&&a.normalScale.set(e,-e),a.needsUpdate=!0)})}o.customEnvMap&&n.environmentMapIntensity>0&&i(o,o.customEnvMap,n.environmentMapIntensity),o.scene.add(o.model),n.handleModelLoaded()},e=>{console.log(e.loaded/e.total*100+"% loaded")},e=>{console.error("An error occurred while loading the model:",e)}),n.local.modelLoading=!0}function draw(a,m,p){var u,d,M,h,g,v,f,y,x,L,D,S,I,E,C,U,P,w,b;const N=e(p);if(!p.local.modelLoaded)return;if(!N.renderer||!N.renderer.getContext()||N.renderer.getContext().isContextLost())return console.warn("Three.js renderer context lost, reinitializing..."),void(p.local.initialized=!1);const z=a.canvas?a.canvas.width:a.drawingBufferWidth,T=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0===z||0===T)return;let A=0,k=0,F=0,R=0,B=0,q=0;if(0!=p.trackMouse||0!=p.rotationTracking||0!=p.lightTracking){const e=p.local.mouse||{x:.5,y:.5},a=e.x-.5,t=e.y-.5;p.trackMouse>0&&(A=a*p.trackMouse,k=-t*p.trackMouse),0!=p.rotationTracking&&(F=-t*p.rotationTracking,R=-a*p.rotationTracking),0!=p.lightTracking&&(B=a*p.lightTracking,q=-t*p.lightTracking)}N.camera.userData.dim||(N.camera.userData.dim={}),N.camera.userData.dim.w===z&&N.camera.userData.dim.h===T||(N.camera.aspect=z/T,N.camera.updateProjectionMatrix(),N.renderer.setSize(z,T,!1),N.camera.userData.dim={w:z,h:T});const G="high"===p.quality;N.renderer.userData.q!==(G?"h":"f")&&o(N,G);const W=N.scene.userData.lp=N.scene.userData.lp||{};!N.ambientLight||W.ai===p.ambientLightIntensity&&W.ac===p.ambientLightColor||(W.ai!==p.ambientLightIntensity&&(N.ambientLight.intensity=2*p.ambientLightIntensity),W.ac!==p.ambientLightColor&&N.ambientLight.color.set(p.ambientLightColor||"#fff"),W.ai=p.ambientLightIntensity,W.ac=p.ambientLightColor),!N.directionalLight||W.li===p.lightIntensity&&W.lc===p.lightColor||(N.directionalLight.intensity=5*p.lightIntensity*2,N.directionalLight.color.set(p.lightColor||"#fff"),W.li=p.lightIntensity,W.lc=p.lightColor),!N.fillLight||W.fli===p.fillLightIntensity&&W.flc===p.fillLightColor||(N.fillLight.intensity=5*p.fillLightIntensity*2,N.fillLight.color.set(p.fillLightColor||"#fff"),W.fli=p.fillLightIntensity,W.flc=p.fillLightColor);const j=p.getProp("lightPosition");if(N.directionalLight&&j&&(p.lightTracking>0||W.lx!==j.x||W.ly!==j.y||W.lz!==j.z)){const e=10*(j.x+B-.5),a=10*(j.y+q-.5),t=10*(j.z-.5);N.directionalLight.position.set(e,-a,t),N.fillLight.position.set(.8*-e,.8*a,.8*-t),0===p.lightTracking&&(W.lx=j.x,W.ly=j.y,W.lz=j.z)}if(N.model){const e=N.model.userData.mp=N.model.userData.mp||{},a=p.getProp("scale");if(e.s!==a){const t=10*a*(N.model.userData.baseScale||1);N.model.scale.set(t,t,t),e.s=a}const o=p.getProp("pos"),z=0!==A||0!==k;if(o&&(z||e.px!==o.x||e.py!==o.y||e.pz!==o.z)){const a=8*(o.x-.5+A),t=8*(o.y-.5+k),n=8*(o.z-.5);N.model.position.set(a,-t,n),z||(e.px=o.x,e.py=o.y,e.pz=o.z)}const T=p.getProp("modelRotation"),B=0!==F||0!==R,q=p.speed>0&&p.animating;if(T&&(B||q||e.rx!==T.x||e.ry!==T.y||e.rz!==T.z)){let a=(T.y-1+F)*Math.PI*2,t=(T.x-.75+R)*Math.PI*2,n=(T.z-.5)*Math.PI*2;if(q){const e=p.speed*m*.001;p.animationAxis.x>0&&(a+=e*p.animationAxis.x),p.animationAxis.y>0&&(t+=e*p.animationAxis.y),p.animationAxis.z>0&&(n+=e*p.animationAxis.z)}N.model.rotation.set(a,t,n),B||q||(e.rx=T.x,e.ry=T.y,e.rz=T.z)}e.mm===p.materialMetalness&&e.mr===p.materialRoughness||(null==(u=N.model.userData.materials)||u.forEach(a=>{e.mm!==p.materialMetalness&&void 0!==a.metalness&&(a.metalnessMap&&(a.metalnessMap=null,a.needsUpdate=!0),a.metalness=p.materialMetalness),e.mr!==p.materialRoughness&&void 0!==a.roughness&&(a.roughnessMap&&(a.roughnessMap=null,a.needsUpdate=!0),a.roughness=p.materialRoughness)}),e.mm=p.materialMetalness,e.mr=p.materialRoughness),e.tu!==p.colorMapUrl&&((null==(d=p.colorMapUrl)?void 0:d.trim())&&t(p)?n(p.colorMapUrl,!1).then(e=>{var a,t,n;const r=Math.max(.001,p.colorMapScale||1);e.repeat.setScalar(r);const o=-(r-1)/2,i=((null==(a=p.colorMapPosition)?void 0:a.x)??.5)-.5,l=((null==(t=p.colorMapPosition)?void 0:t.y)??.5)-.5;e.offset.set(o+i,o+l),N.customColorMap&&N.customColorMap.dispose(),N.customColorMap=e,null==(n=N.model.userData.textureMaterials)||n.forEach(a=>{a.map=e,a.needsUpdate=!0})}):N.customColorMap&&(N.customColorMap.dispose(),N.customColorMap=null,null==(M=N.model.userData.textureMaterials)||M.forEach(e=>{e.map=e.userData.originalMap||null,e.needsUpdate=!0})),e.tu=p.colorMapUrl);let G=p.getProp("colorMapPosition");if(N.customColorMap&&t(p)&&(e.ts!==p.colorMapScale||e.tpx!==(null==G?void 0:G.x)||e.tpy!==(null==G?void 0:G.y))){const a=Math.max(.001,p.colorMapScale);N.customColorMap.repeat.setScalar(a);const t=-(a-1)/2,n=((null==G?void 0:G.x)??.5)-.5,r=((null==G?void 0:G.y)??.5)-.5;N.customColorMap.offset.set(t+n,t+r),null==(h=N.model.userData.textureMaterials)||h.forEach(e=>{e.needsUpdate=!0}),e.ts=p.colorMapScale,e.tpx=null==(g=p.colorMapPosition)?void 0:g.x,e.tpy=null==(v=p.colorMapPosition)?void 0:v.y}if(e.nmu!==p.normalMapUrl&&((null==(f=p.normalMapUrl)?void 0:f.trim())&&!p.renderNormals?n(p.normalMapUrl,!1,!0).then(e=>{var a,t,n;r(N,e);const o=Math.max(.001,p.normalMapScale||1);e.repeat.setScalar(o);const i=-(o-1)/2,l=((null==(a=p.normalMapPosition)?void 0:a.x)??.5)-.5,s=((null==(t=p.normalMapPosition)?void 0:t.y)??.5)-.5;e.offset.set(i+l,i+s),N.customNormalMap&&N.customNormalMap.dispose(),N.customNormalMap=e;const m=p.normalMapIntensity??1;null==(n=N.model.userData.textureMaterials)||n.forEach(a=>{void 0!==a.normalMap&&(a.normalMap=e,a.normalScale&&a.normalScale.set(m,-m),a.needsUpdate=!0)})}):N.customNormalMap&&(N.customNormalMap.dispose(),N.customNormalMap=null,null==(y=N.model.userData.textureMaterials)||y.forEach(e=>{void 0!==e.normalMap&&(e.normalMap=e.userData.originalNormalMap||null,e.needsUpdate=!0)})),e.nmu=p.normalMapUrl),N.customNormalMap&&!p.renderNormals&&(e.nms!==p.normalMapScale||e.nmpx!==(null==(x=p.normalMapPosition)?void 0:x.x)||e.nmpy!==(null==(L=p.normalMapPosition)?void 0:L.y)||e.nmi!==p.normalMapIntensity)){const a=Math.max(.001,p.normalMapScale);N.customNormalMap.repeat.setScalar(a);const t=-(a-1)/2,n=((null==(D=p.normalMapPosition)?void 0:D.x)??.5)-.5,r=((null==(S=p.normalMapPosition)?void 0:S.y)??.5)-.5;N.customNormalMap.offset.set(t+n,t+r);const o=p.normalMapIntensity??1;null==(I=N.model.userData.textureMaterials)||I.forEach(e=>{e.normalScale&&e.normalScale.set(o,-o),e.needsUpdate=!0}),e.nms=p.normalMapScale,e.nmpx=null==(E=p.normalMapPosition)?void 0:E.x,e.nmpy=null==(C=p.normalMapPosition)?void 0:C.y,e.nmi=p.normalMapIntensity}if(e.rn!==p.renderNormals&&(null==(U=N.model.userData.meshes)||U.forEach(e=>{p.renderNormals?(e.userData.origMat||(e.userData.origMat=e.material),e.material=c):e.userData.origMat&&(e.material=e.userData.origMat)}),e.rn=p.renderNormals),e.emu!==p.environmentMapUrl){if((null==(P=p.environmentMapUrl)?void 0:P.trim())&&p.environmentMapIntensity>0)n(p.environmentMapUrl,!0).then(e=>{N.customEnvMap&&N.customEnvMap.dispose(),N.customEnvMap=e,i(N,N.customEnvMap,p.environmentMapIntensity)});else if(N.customEnvMap&&(N.customEnvMap.dispose(),N.customEnvMap=null),p.environmentMapIntensity>0){const e=p.local.envTexture;e&&s(N,e.gl,e.webglTexture,e.width,e.height,p.environmentMapIntensity)}else l(N);e.emu=p.environmentMapUrl}const W=p.local.envTexture,j=N.customEnvMap&&(null==(w=p.environmentMapUrl)?void 0:w.trim()),_=e.emi!==p.environmentMapIntensity,H=!j&&W;!N.customEnvMap&&(null==(b=p.environmentMapUrl)?void 0:b.trim())&&p.environmentMapIntensity>0?(n(p.environmentMapUrl,!0).then(e=>{N.customEnvMap=e,i(N,N.customEnvMap,p.environmentMapIntensity)}),e.emi=p.environmentMapIntensity):(_||H&&!N.envMap)&&(j&&p.environmentMapIntensity>0?(i(N,N.customEnvMap,p.environmentMapIntensity),e.emi=p.environmentMapIntensity):H&&p.environmentMapIntensity>0?(s(N,W.gl,W.webglTexture,W.width,W.height,p.environmentMapIntensity),e.emi=p.environmentMapIntensity):_&&(l(N),e.emi=p.environmentMapIntensity))}N.renderer.render(N.scene,N.camera),N.renderer.resetState&&N.renderer.resetState()}function dispose(a){const t=e(a);t.customColorMap&&(t.customColorMap.dispose(),t.customColorMap=null),t.customNormalMap&&(t.customNormalMap.dispose(),t.customNormalMap=null),t.customEnvMap&&(t.customEnvMap.dispose(),t.customEnvMap=null),l(t),t.model&&(t.model.traverse(e=>{e.isMesh&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material&&e.material.dispose())}),t.scene&&t.scene.remove(t.model),t.model=null),t.renderer&&(t.renderer.dispose(),t.renderer=null),t.scene=null,t.camera=null,t.ambientLight=null,t.directionalLight=null,t.fillLight=null,u.delete(a)}import{G as GLTFLoader,T as THREE}from"./three-bundle.js";const m=new GLTFLoader,p=new THREE.TextureLoader,c=new THREE.MeshNormalMaterial,u=new WeakMap;