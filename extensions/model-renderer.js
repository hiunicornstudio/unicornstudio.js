function e(e){return g.has(e)||g.set(e,{scene:null,camera:null,renderer:null,model:null,ambientLight:null,directionalLight:null,fillLight:null,customNormalMap:null,customEnvMap:null,envMap:null,customColorMap:null}),g.get(e)}function a(e){const a=new THREE.MeshStandardMaterial;return a.color.copy(e.color),a.map=e.map,a.normalMap=e.normalMap,a.emissiveMap=e.emissiveMap,a.aoMap=e.aoMap,a.emissive.copy(e.emissive||new THREE.Color(0,0,0)),a.opacity=e.opacity??1,a.transparent=e.transparent??!1,a.side=e.side??THREE.FrontSide,e.userData||(e.userData={}),a.userData=e.userData,a.userData.converted=!0,a}function t(e,a){e.renderer&&(e.renderer.toneMapping=a?THREE.ACESFilmicToneMapping:THREE.NoToneMapping,e.renderer.toneMappingExposure=a?1.5:1,e.renderer.physicallyCorrectLights=a)}function r(e,a=!1,t=!1){return new Promise(t=>{d.load(e,e=>{a?(e.mapping=THREE.EquirectangularReflectionMapping,e.colorSpace=THREE.SRGBColorSpace,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1):(e.wrapS=e.wrapT=THREE.RepeatWrapping,e.flipY=!0),t(e)})})}function o(e,a,t,r,o="map",n=1,l=1){a.repeat.setScalar(t);const i=-(t-1)/2,s=((null==r?void 0:r.x)??.5)-.5,m=((null==r?void 0:r.y)??.5)-.5;a.offset.set(i+s,i+m),e.model.traverse(e=>{e.isMesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhongMaterial||e.isMeshLambertMaterial)&&("map"===o?(e.map=a,e.color&&e.color.setScalar(l)):"normalMap"===o&&void 0!==e.normalMap&&(e.normalMap=a,e.normalScale&&e.normalScale.set(n,-n)),e.needsUpdate=!0)})})}function n(e,a,t){var r;a&&e.model&&(null==(r=e.model.userData.materials)||r.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMap=a,e.envMapIntensity=t,e.needsUpdate=!0)}))}function l(e,a,t){const r=new THREE.Group;for(let o=0;o<e.length;o++){const n=e[o],l=n.userData.style.fill;if(void 0!==l&&"none"!==l){const e=new THREE.MeshStandardMaterial({color:(new THREE.Color).setStyle(l),metalness:t.getProp("materialMetalness")??.5,roughness:t.getProp("materialRoughness")??.5,side:THREE.DoubleSide}),o=m.createShapes(n);for(let t=0;t<o.length;t++){const n=o[t],l=new THREE.ExtrudeGeometry(n,a),i=l.attributes.position,s=l.attributes.uv;l.computeBoundingBox();const m=l.boundingBox.min,p=l.boundingBox.max,c=p.x-m.x,d=p.y-m.y,u=(e,a,t)=>{for(let r=e;e+a>r;r++){let e=r;if(l.index&&(e=l.index.getX(r)),t){const a=s.getX(e),t=s.getY(e),r=1/Math.max(c,d);s.setXY(e,a*r,t*r)}else{const a=i.getX(e),t=i.getY(e);s.setXY(e,(a-m.x)/c,(t-m.y)/d)}}};l.groups&&l.groups.length>0?l.groups.forEach(e=>{u(e.start,e.count,1===e.materialIndex)}):u(0,l.index?l.index.count:i.count,!1),s.needsUpdate=!0;const g=new THREE.Mesh(l,e);g.scale.set(1,-1,1),r.add(g)}}}return r}function i(e,a,t,r,o,l){var i,s,m;if(t&&a)if(e.envMap)e.model.userData.lastEnvMapIntensity!==l&&(null==(m=e.model.userData.materials)||m.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMapIntensity=l)}),e.model.userData.lastEnvMapIntensity=l);else{e.envMap=new THREE.Texture,e.envMap.mapping=THREE.EquirectangularReflectionMapping,e.envMap.colorSpace=THREE.SRGBColorSpace,e.envMap.minFilter=THREE.LinearFilter,e.envMap.magFilter=THREE.LinearFilter,e.envMap.generateMipmaps=!1,e.envMap.flipY=!1,e.envMap.image={width:r,height:o};const a=e.renderer.properties.get(e.envMap);a.__webglTexture=t,a.__webglInit=!0;const i=e.renderer.info.memory;i&&i.textures++,n(e,e.envMap,l)}else null==(s=null==(i=e.model)?void 0:i.userData.materials)||s.forEach(e=>{e.envMap&&(e.envMap=null,e.needsUpdate=!0)})}function initialize(a,r){const o=e(r),n=a.canvas?a.canvas.width:a.drawingBufferWidth,l=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0===n||0===l)return;o.scene=new THREE.Scene,o.camera=new THREE.PerspectiveCamera(35,n/l,.1,100),o.camera.position.set(0,0,5),o.renderer=new THREE.WebGLRenderer({canvas:a.canvas,context:a,alpha:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0,antialias:"high"===r.quality}),o.renderer.setClearColor(0,0),o.renderer.outputColorSpace=THREE.SRGBColorSpace,t(o,"high"===r.quality),o.renderer.setPixelRatio(1),o.renderer.setSize(n,l,!1);const i=r.getProp("ambientLightColor"),s=r.getProp("ambientLightIntensity"),m=r.getProp("lightColor"),p=r.getProp("lightIntensity"),c=r.getProp("fillLightColor"),d=r.getProp("fillLightIntensity"),u=r.getProp("lightPosition");o.ambientLight=new THREE.AmbientLight(i||"#777777",2*(s??.75)),o.scene.add(o.ambientLight),o.directionalLight=new THREE.DirectionalLight(m||"#777777",5*(p??.2)*2),o.scene.add(o.directionalLight),o.fillLight=new THREE.DirectionalLight(c||"#777777",5*(d??.2)*2),o.scene.add(o.fillLight);const g=10*(u.x-.5),M=10*(u.y-.5),h=10*(u.z-.5);o.directionalLight&&o.directionalLight.position.set(g,-M,h),o.fillLight&&o.fillLight.position.set(.8*-g,.8*M,.8*-h)}function loadModel(t){const i=e(t);t.local.modelLoaded=!1,t.local.modelLoading=!1;const s=t.modelUrl.toLowerCase(),m=s.startsWith("data:image/svg+xml");if(s.split("?")[0].endsWith(".svg")||m){const e=e=>{var a,s;const m=e.paths,p=l(m,{depth:t.getProp("extrudeDepth")??10,bevelEnabled:t.getProp("bevelEnabled")??!1,bevelThickness:t.getProp("bevelThickness")??1,bevelSize:t.getProp("bevelSize")??1,bevelSegments:t.getProp("bevelSegments")??2},t);i.model=p,i.model.userData.isSVG=!0,i.model.userData.svgPaths=m;const c=(new THREE.Box3).setFromObject(i.model),d=c.getCenter(new THREE.Vector3);i.model.position.copy(d).multiplyScalar(-1);const g=c.getSize(new THREE.Vector3),M=Math.max(g.x,g.y,g.z),h=M>0?1/M:1,v=new THREE.Group;v.add(i.model),i.model=v,i.model.userData.baseScale=h,i.model.userData.isSVGWrapper=!0,i.model.userData.materials=[],i.model.userData.textureMaterials=[],i.model.userData.meshes=[],i.model.traverse(e=>{e.isMesh&&(i.model.userData.meshes.push(e),i.model.userData.materials.push(e.material),i.model.userData.textureMaterials.push(e.material),e.material.userData||(e.material.userData={}),e.material.userData.originalMap=null,e.material.userData.originalNormalMap=null)}),t.renderNormals&&i.model.userData.meshes&&i.model.userData.meshes.forEach(e=>{e.userData.originalMaterial||(e.userData.originalMaterial=e.material,e.material=u)}),(null==(a=t.colorMapUrl)?void 0:a.trim())&&!t.renderNormals&&r(t.colorMapUrl,!1).then(e=>{const a=Math.max(.001,t.getProp("colorMapScale")??1),r=t.getProp("colorMapIntensity")??1;o(i,e,a,t.getProp("colorMapPosition"),"map",1,r),i.customColorMap=e}),(null==(s=t.normalMapUrl)?void 0:s.trim())&&!t.renderNormals&&r(t.normalMapUrl,!1,!0).then(e=>{const a=Math.max(.001,t.getProp("normalMapScale")??1);o(i,e,a,t.getProp("normalMapPosition"),"normalMap",t.getProp("normalMapIntensity")),i.customNormalMap=e}),i.customEnvMap&&t.environmentMapIntensity>0&&n(i,i.customEnvMap,t.environmentMapIntensity),i.scene.add(i.model),t.handleModelLoaded()};if(m)try{const a=t.modelUrl.split(",")[1],r=decodeURIComponent(escape(atob(a)));e(c.parse(r))}catch(e){console.error("An error occurred while parsing the SVG data URL:",e),t.local.modelLoading=!1}else c.load(t.modelUrl,e,e=>{e.total>0&&console.log(e.loaded/e.total*100+"% loaded")},e=>{console.error("An error occurred while loading the SVG:",e),t.local.modelLoading=!1})}else p.load(t.modelUrl,e=>{var l;i.model=e.scene;const s=(new THREE.Box3).setFromObject(i.model),m=s.getCenter(new THREE.Vector3);i.model.position.copy(m).multiplyScalar(-1);const p=s.getSize(new THREE.Vector3),c=Math.max(p.x,p.y,p.z),d=c>0?1/c:1,g=new THREE.Group;g.add(i.model),i.model=g,i.model.userData.baseScale=d,i.model.userData.materials=[],i.model.traverse(e=>{if(e.isMesh){const r=Array.isArray(e.material)?e.material:[e.material],o=t.getProp("materialMetalness"),n=t.getProp("materialRoughness");r.forEach((t,r)=>{var l;if((t.isMeshPhongMaterial||t.isMeshLambertMaterial)&&!(null==(l=t.userData)?void 0:l.converted)){const o=a(t);Array.isArray(e.material)?e.material[r]=o:e.material=o,t=o}i.model.userData.materials.push(t),void 0!==t.metalness&&(t.metalnessMap&&(t.metalnessMap=null,t.needsUpdate=!0),t.metalness=o??t.metalness),void 0!==t.roughness&&(t.roughnessMap&&(t.roughnessMap=null,t.needsUpdate=!0),t.roughness=n??t.roughness),(t.isMeshStandardMaterial||t.isMeshPhysicalMaterial)&&(t.envMapIntensity=t.envMapIntensity??1)}),t.renderNormals&&(e.material=u)}}),t.colorMapUrl&&!t.renderNormals&&(i.model.traverse(e=>{e.isMesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhongMaterial||e.isMeshLambertMaterial)&&(e.map=null,e.needsUpdate=!0)})}),r(t.colorMapUrl,!1).then(e=>{i.customColorMap=e;const a=t.getProp("colorMapIntensity")??1;o(i,e,Math.max(.001,t.getProp("colorMapScale")),t.getProp("colorMapPosition"),"map",1,a)})),t.normalMapUrl&&!t.renderNormals&&r(t.normalMapUrl,!1,!0).then(e=>{i.customNormalMap=e,o(i,e,Math.max(.001,t.getProp("normalMapScale")),t.getProp("normalMapPosition"),"normalMap",t.getProp("normalMapIntensity"))});const M=t.getProp("environmentMapIntensity");M>0&&(null==(l=t.environmentMapUrl)?void 0:l.trim())&&r(t.environmentMapUrl,!0).then(e=>{i.customEnvMap=e,n(i,i.customEnvMap,M)}),i.scene.add(i.model),t.handleModelLoaded()},void 0,e=>{console.error("An error occurred while loading the model:",e)});t.local.modelLoading=!0}function s(e){return e.local.modelLoading&&!e.local.modelLoaded}function draw(a,t,r){var o,l,s,m,p;const c=e(r);if(!r.local.modelLoaded)return;if(!c.renderer||!c.renderer.getContext()||c.renderer.getContext().isContextLost())return console.warn("Three.js renderer context lost, reinitializing..."),void(r.local.initialized=!1);const d=a.canvas?a.canvas.width:a.drawingBufferWidth,u=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0===d||0===u)return;const g=r.getProp("environmentMapIntensity");if(g>0&&!(null==(o=r.environmentMapUrl)?void 0:o.trim())){const e=r.local.envTexture,a=(null==(l=c.model)?void 0:l.userData.lastEnvMapIntensity)!==g;!e||!a&&c.envMap||i(c,e.gl,e.webglTexture,e.width,e.height,g)}let M=0,h=0,v=0,y=0,f=0,P=0;const x=r.getProp("trackMouse"),L=r.getProp("rotationTracking"),S=r.getProp("lightTracking");if(0!=x||0!=L||0!=S){const e=r.local.mouse||{x:.5,y:.5},a=e.x-.5,t=e.y-.5;0!=x&&(M=a*x,h=-t*x),0!=L&&(v=-t*L,y=-a*L),0!=S&&(f=a*S,P=-t*S)}c.camera.userData.dim||(c.camera.userData.dim={}),c.camera.userData.dim.w===d&&c.camera.userData.dim.h===u||(c.camera.aspect=d/u,c.camera.updateProjectionMatrix(),c.renderer.setSize(d,u,!1),c.camera.userData.dim={w:d,h:u});const D=c.scene.userData.lp=c.scene.userData.lp||{},w=r.getProp("ambientLightIntensity"),b=r.getProp("ambientLightColor"),C=r.getProp("lightIntensity"),E=r.getProp("lightColor"),I=r.getProp("fillLightIntensity"),z=r.getProp("fillLightColor");!c.ambientLight||D.ai===w&&D.ac===b||(D.ai!==w&&(c.ambientLight.intensity=2*(w??.75)),D.ac!==b&&c.ambientLight.color.set(b||"#777777"),D.ai=w,D.ac=b),!c.directionalLight||D.li===C&&D.lc===E||(c.directionalLight.intensity=5*(C??.2)*2,c.directionalLight.color.set(E||"#777777"),D.li=C,D.lc=E),!c.fillLight||D.fli===I&&D.flc===z||(c.fillLight.intensity=5*(I??.2)*2,c.fillLight.color.set(z||"#777777"),D.fli=I,D.flc=z);const U=r.getProp("lightPosition"),N=0!=S;if(c.directionalLight&&U&&(N||D.lx!==U.x||D.ly!==U.y||D.lz!==U.z)){const e=10*(U.x+f-.5),a=10*(U.y+P-.5),t=10*(U.z-.5);c.directionalLight.position.set(e,-a,t),c.fillLight.position.set(.8*-e,.8*a,.8*-t),N||(D.lx=U.x,D.ly=U.y,D.lz=U.z)}if(c.model){const e=c.model.userData.mp=c.model.userData.mp||{},a=r.getProp("materialMetalness"),o=r.getProp("materialRoughness");e.mm===a&&e.mr===o||(null==(s=c.model.userData.materials)||s.forEach(t=>{e.mm!==a&&void 0!==t.metalness&&(t.metalnessMap&&(t.metalnessMap=null,t.needsUpdate=!0),t.metalness=a),e.mr!==o&&void 0!==t.roughness&&(t.roughnessMap&&(t.roughnessMap=null,t.needsUpdate=!0),t.roughness=o)}),e.mm=a,e.mr=o);const l=r.getProp("colorMapScale"),i=r.getProp("colorMapPosition"),d=r.getProp("colorMapIntensity");if(c.customColorMap&&!r.renderNormals&&(e.cms!==l||e.cmpx!==(null==i?void 0:i.x)||e.cmpy!==(null==i?void 0:i.y)||e.cmi!==d)){const a=Math.max(.001,l);c.customColorMap.repeat.setScalar(a);const t=-(a-1)/2,r=((null==i?void 0:i.x)??.5)-.5,o=((null==i?void 0:i.y)??.5)-.5;c.customColorMap.offset.set(t+r,t+o);const n=d??1;null==(m=c.model.userData.materials)||m.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhongMaterial||e.isMeshLambertMaterial)&&(e.color&&e.color.setScalar(n),e.needsUpdate=!0)}),e.cms=l,e.cmpx=null==i?void 0:i.x,e.cmpy=null==i?void 0:i.y,e.cmi=d}const u=r.getProp("normalMapScale"),f=r.getProp("normalMapPosition"),P=r.getProp("normalMapIntensity");if(c.customNormalMap&&!r.renderNormals&&(e.nms!==u||e.nmpx!==(null==f?void 0:f.x)||e.nmpy!==(null==f?void 0:f.y)||e.nmi!==P)){const a=Math.max(.001,u);c.customNormalMap.repeat.setScalar(a);const t=-(a-1)/2,r=((null==f?void 0:f.x)??.5)-.5,o=((null==f?void 0:f.y)??.5)-.5;c.customNormalMap.offset.set(t+r,t+o);const n=P??1;null==(p=c.model.userData.materials)||p.forEach(e=>{void 0!==e.normalMap&&e.normalScale&&(e.normalScale.set(n,-n),e.needsUpdate=!0)}),e.nms=u,e.nmpx=null==f?void 0:f.x,e.nmpy=null==f?void 0:f.y,e.nmi=P}c.customEnvMap&&e.emi!==g&&(n(c,c.customEnvMap,g),e.emi=g);const x=c.model.userData.baseScale||1,L=r.getProp("pos"),S=r.getProp("scale");if(e.s!==S){const a=10*S*x;c.model.scale.set(a,a,a),e.s=S}const D=0!==M||0!==h;if(L&&(D||e.px!==L.x||e.py!==L.y||e.pz!==L.z)){const a=8*(L.x-.5+M),t=8*(L.y-.5+h),r=8*(L.z-.5);c.model.position.set(a,-t,r),D||(e.px=L.x,e.py=L.y,e.pz=L.z)}const w=r.getProp("modelRotation"),b=r.getProp("speed"),C=r.getProp("animationAxis"),E=0!==v||0!==y,I=b>0&&r.animating;if(w&&(E||I||e.rx!==w.x||e.ry!==w.y||e.rz!==w.z)){let a=(w.y-.5+v)*Math.PI*2+Math.PI,r=c.model.userData.isSVGWrapper?Math.PI:0,o=(w.x-.5+y)*Math.PI*2+r,n=(w.z-.5)*Math.PI*2;if(I){const e=b*t*.001;C.x>0&&(a+=e*C.x),C.y>0&&(o+=e*C.y),C.z>0&&(n+=e*C.z)}c.model.rotation.set(a,o,n),E||I||(e.rx=w.x,e.ry=w.y,e.rz=w.z)}}c.renderer.render(c.scene,c.camera),c.renderer.resetState&&c.renderer.resetState()}function dispose(a){const t=e(a);t.customColorMap&&(t.customColorMap.dispose(),t.customColorMap=null),t.customNormalMap&&(t.customNormalMap.dispose(),t.customNormalMap=null),t.customEnvMap&&(t.customEnvMap.dispose(),t.customEnvMap=null),t.envMap&&(t.envMap.dispose(),t.envMap=null),t.model&&(t.model.traverse(e=>{e.isMesh&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material&&e.material.dispose())}),t.scene&&t.scene.remove(t.model),t.model=null),t.renderer&&(t.renderer.dispose(),t.renderer=null),t.scene=null,t.camera=null,t.ambientLight=null,t.directionalLight=null,t.fillLight=null,g.delete(a)}import{G as GLTFLoader,S as m,T as THREE}from"./three-bundle.js";const p=new GLTFLoader,c=new m,d=new THREE.TextureLoader,u=new THREE.MeshNormalMaterial,g=new WeakMap;