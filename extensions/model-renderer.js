function e(e){return d.has(e)||d.set(e,{scene:null,camera:null,renderer:null,model:null,ambientLight:null,directionalLight:null,fillLight:null,customNormalMap:null,customEnvMap:null,envMap:null}),d.get(e)}function a(e){const a=new THREE.MeshStandardMaterial;return a.color.copy(e.color),a.map=e.map,a.normalMap=e.normalMap,a.emissiveMap=e.emissiveMap,a.aoMap=e.aoMap,a.emissive.copy(e.emissive||new THREE.Color(0,0,0)),a.opacity=e.opacity??1,a.transparent=e.transparent??!1,a.side=e.side??THREE.FrontSide,e.userData||(e.userData={}),a.userData=e.userData,a.userData.converted=!0,a}function t(e,a){e.renderer&&(e.renderer.toneMapping=a?THREE.ACESFilmicToneMapping:THREE.NoToneMapping,e.renderer.toneMappingExposure=a?1.5:1,e.renderer.physicallyCorrectLights=a)}function n(e,a=!1,t=!1){return new Promise(t=>{m.load(e,e=>{a?(e.mapping=THREE.EquirectangularReflectionMapping,e.colorSpace=THREE.SRGBColorSpace,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1):(e.wrapS=e.wrapT=THREE.RepeatWrapping,e.flipY=!0),t(e)})})}function r(e,a,t,n,r="map",i=1){a.repeat.setScalar(t);const l=-(t-1)/2,o=((null==n?void 0:n.x)??.5)-.5,s=((null==n?void 0:n.y)??.5)-.5;a.offset.set(l+o,l+s),e.model.traverse(e=>{e.isMesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhongMaterial||e.isMeshLambertMaterial)&&("map"===r?e.map=a:"normalMap"===r&&void 0!==e.normalMap&&(e.normalMap=a,e.normalScale&&e.normalScale.set(i,-i)),e.needsUpdate=!0)})})}function i(e,a,t){var n;a&&e.model&&(null==(n=e.model.userData.materials)||n.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMap=a,e.envMapIntensity=t,e.needsUpdate=!0)}))}function l(e,a,t,n,r,l){var o,s,m;if(t&&a)if(e.envMap)e.model.userData.lastEnvMapIntensity!==l&&(null==(m=e.model.userData.materials)||m.forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhysicalMaterial)&&(e.envMapIntensity=l)}),e.model.userData.lastEnvMapIntensity=l);else{e.envMap=new THREE.Texture,e.envMap.mapping=THREE.EquirectangularReflectionMapping,e.envMap.colorSpace=THREE.SRGBColorSpace,e.envMap.minFilter=THREE.LinearFilter,e.envMap.magFilter=THREE.LinearFilter,e.envMap.generateMipmaps=!1,e.envMap.flipY=!1,e.envMap.image={width:n,height:r};const a=e.renderer.properties.get(e.envMap);a.__webglTexture=t,a.__webglInit=!0;const o=e.renderer.info.memory;o&&o.textures++,i(e,e.envMap,l)}else null==(s=null==(o=e.model)?void 0:o.userData.materials)||s.forEach(e=>{e.envMap&&(e.envMap=null,e.needsUpdate=!0)})}function initialize(a,n){const r=e(n),i=a.canvas?a.canvas.width:a.drawingBufferWidth,l=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0!==i&&0!==l&&(r.scene=new THREE.Scene,r.camera=new THREE.PerspectiveCamera(35,i/l,.1,100),r.camera.position.set(0,0,5),r.renderer=new THREE.WebGLRenderer({canvas:a.canvas,context:a,alpha:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0,antialias:"high"===n.quality}),r.renderer.setClearColor(0,0),r.renderer.outputColorSpace=THREE.SRGBColorSpace,t(r,"high"===n.quality),r.renderer.setPixelRatio(1),r.renderer.setSize(i,l,!1),r.ambientLight=new THREE.AmbientLight(n.ambientLightColor||"#ffffff",2*(n.ambientLightIntensity??.75)),r.scene.add(r.ambientLight),r.directionalLight=new THREE.DirectionalLight(n.lightColor||"#ffffff",5*(n.lightIntensity??.2)*2),r.scene.add(r.directionalLight),r.fillLight=new THREE.DirectionalLight(n.fillLightColor||"#ffffff",5*(n.fillLightIntensity??.2)*2),r.scene.add(r.fillLight),n.lightPosition)){const e=10*(n.lightPosition.x-.5),a=10*(n.lightPosition.y-.5),t=10*(n.lightPosition.z-.5);r.directionalLight&&r.directionalLight.position.set(e,-a,t),r.fillLight&&r.fillLight.position.set(.8*-e,.8*a,.8*-t)}}function loadModel(t){const o=e(t);s.load(t.modelUrl,e=>{var s;o.model=e.scene;const m=(new THREE.Box3).setFromObject(o.model),d=m.getCenter(new THREE.Vector3);o.model.position.copy(d).multiplyScalar(-1);const p=m.getSize(new THREE.Vector3),h=Math.max(p.x,p.y,p.z),u=h>0?1/h:1,M=new THREE.Group;if(M.add(o.model),o.model=M,o.model.userData.baseScale=u,o.model.userData.materials=[],o.model.traverse(e=>{e.isMesh&&((Array.isArray(e.material)?e.material:[e.material]).forEach((n,r)=>{var i;if((n.isMeshPhongMaterial||n.isMeshLambertMaterial)&&!(null==(i=n.userData)?void 0:i.converted)){const t=a(n);Array.isArray(e.material)?e.material[r]=t:e.material=t,n=t}o.model.userData.materials.push(n),void 0!==n.metalness&&(n.metalnessMap&&(n.metalnessMap=null,n.needsUpdate=!0),n.metalness=t.materialMetalness??n.metalness),void 0!==n.roughness&&(n.roughnessMap&&(n.roughnessMap=null,n.needsUpdate=!0),n.roughness=t.materialRoughness??n.roughness),(n.isMeshStandardMaterial||n.isMeshPhysicalMaterial)&&(n.envMapIntensity=n.envMapIntensity??1)}),t.renderNormals&&(e.material=c))}),t.colorMapUrl&&!t.renderNormals&&(o.model.traverse(e=>{e.isMesh&&(Array.isArray(e.material)?e.material:[e.material]).forEach(e=>{(e.isMeshStandardMaterial||e.isMeshPhongMaterial||e.isMeshLambertMaterial)&&(e.map=null,e.needsUpdate=!0)})}),n(t.colorMapUrl,!1).then(e=>{r(o,e,Math.max(.001,t.colorMapScale||1),t.colorMapPosition,"map")})),t.normalMapUrl&&!t.renderNormals&&n(t.normalMapUrl,!1,!0).then(e=>{r(o,e,Math.max(.001,t.normalMapScale||1),t.normalMapPosition,"normalMap",t.normalMapIntensity??1)}),t.environmentMapIntensity>0)if(null==(s=t.environmentMapUrl)?void 0:s.trim())n(t.environmentMapUrl,!0).then(e=>{o.customEnvMap=e,i(o,o.customEnvMap,t.environmentMapIntensity)});else{const e=t.local.envTexture;e&&l(o,e.gl,e.webglTexture,e.width,e.height,t.environmentMapIntensity)}o.scene.add(o.model),t.handleModelLoaded()},void 0,e=>{console.error("An error occurred while loading the model:",e)}),t.local.modelLoading=!0}function o(e){return e.local.modelLoading&&!e.local.modelLoaded}function draw(a,t,n){const r=e(n);if(!n.local.modelLoaded)return;if(!r.renderer||!r.renderer.getContext()||r.renderer.getContext().isContextLost())return console.warn("Three.js renderer context lost, reinitializing..."),void(n.local.initialized=!1);const i=a.canvas?a.canvas.width:a.drawingBufferWidth,l=a.canvas?a.canvas.height:a.drawingBufferHeight;if(0===i||0===l)return;let o=0,s=0,m=0,c=0,d=0,p=0;if(0!=n.trackMouse||0!=n.rotationTracking||0!=n.lightTracking){const e=n.local.mouse||{x:.5,y:.5},a=e.x-.5,t=e.y-.5;0!=n.trackMouse&&(o=a*n.trackMouse,s=-t*n.trackMouse),0!=n.rotationTracking&&(m=-t*n.rotationTracking,c=-a*n.rotationTracking),0!=n.lightTracking&&(d=a*n.lightTracking,p=-t*n.lightTracking)}if(r.camera.userData.dim||(r.camera.userData.dim={}),r.camera.userData.dim.w===i&&r.camera.userData.dim.h===l||(r.camera.aspect=i/l,r.camera.updateProjectionMatrix(),r.renderer.setSize(i,l,!1),r.camera.userData.dim={w:i,h:l}),r.directionalLight&&0!=n.lightTracking&&n.lightPosition){const e=10*(n.lightPosition.x+d-.5),a=10*(n.lightPosition.y+p-.5),t=10*(n.lightPosition.z-.5);r.directionalLight.position.set(e,-a,t),r.fillLight.position.set(.8*-e,.8*a,.8*-t)}if(r.model){const e=r.model.userData.baseScale||1,a=n.getProp("pos"),i=10*n.getProp("scale")*e;if(r.model.scale.set(i,i,i),a){const e=8*(a.x-.5+o),t=8*(a.y-.5+s),n=8*(a.z-.5);r.model.position.set(e,-t,n)}const l=n.getProp("modelRotation");if(l){const e=n.speed>0&&n.animating;let a=(l.y-1+m)*Math.PI*2,i=(l.x-.75+c)*Math.PI*2,o=(l.z-.5)*Math.PI*2;if(e){const e=n.speed*t*.001;n.animationAxis.x>0&&(a+=e*n.animationAxis.x),n.animationAxis.y>0&&(i+=e*n.animationAxis.y),n.animationAxis.z>0&&(o+=e*n.animationAxis.z)}r.model.rotation.set(a,i,o)}}r.renderer.render(r.scene,r.camera),r.renderer.resetState&&r.renderer.resetState()}function dispose(a){const t=e(a);t.customNormalMap&&(t.customNormalMap.dispose(),t.customNormalMap=null),t.customEnvMap&&(t.customEnvMap.dispose(),t.customEnvMap=null),t.envMap&&(t.envMap.dispose(),t.envMap=null),t.model&&(t.model.traverse(e=>{e.isMesh&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material&&e.material.dispose())}),t.scene&&t.scene.remove(t.model),t.model=null),t.renderer&&(t.renderer.dispose(),t.renderer=null),t.scene=null,t.camera=null,t.ambientLight=null,t.directionalLight=null,t.fillLight=null,d.delete(a)}import{G as GLTFLoader,T as THREE}from"./three-bundle.js";const s=new GLTFLoader,m=new THREE.TextureLoader,c=new THREE.MeshNormalMaterial,d=new WeakMap;